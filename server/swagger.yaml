openapi: 3.0.0
info:
  title: Smart Inventory Optimizer API
  description: API documentation for the Smart Inventory Optimizer project
  version: 1.0.0

servers:
  - url: https://smart-inventory-optimizer.vercel.app/
    description: SIO API
  - url: "http://localhost:{port}"
    description: Local server
    variables:
      port:
        default: "3000"

paths:
  /api/statistics/monthly-category-revenues:
    get:
      summary: Get categoris revenues in spacific duration
      description: |
        Retrieves monthly revenue statistics grouped by category for the specified date range.
        The endpoint aggregates revenue by category and month. Each entry in the response includes the category ID, category name,
        and an array of monthly revenues where each month is represented in YYYY-MM format.
      operationId: getMonthlyCategoryRevenues
      tags:
        - Statistics
      security:
        - bearerAuth: []
      parameters:
        - name: startDate
          in: query
          description: Start date of the period (ISO 8601 format)
          required: true
          schema:
            type: string
            format: date-time
            example: "2023-01-01T00:00:00Z"
        - name: endDate
          in: query
          description: End date of the period (ISO 8601 format)
          required: true
          schema:
            type: string
            format: date-time
            example: "2023-12-31T23:59:59Z"
      responses:
        "200":
          description: Successful response with monthly category revenue data.
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        categoryId:
                          type: number
                          description: Unique identifier of the category.
                        categoryName:
                          type: string
                          description: Name of the category.
                        monthlyRevenues:
                          type: array
                          description: Array of revenue objects for each month in the given range.
                          items:
                            type: object
                            properties:
                              month:
                                type: string
                                description: Month in YYYY-MM format.
                                example: "2023-01"
                              revenue:
                                type: number
                                description: Total revenue for the month.
        "400":
          description: Bad Request - Missing or invalid startDate/endDate.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "startDate and endDate are required"
        "500":
          description: Internal Server Error.
      x-codeSamples:
        - lang: JavaScript
          source: |
            fetch('/api/statistics/monthly-category-revenues?startDate=2023-01-01T00:00:00Z&endDate=2023-12-31T23:59:59Z', {
              method: 'GET',
              headers: {
                'Authorization': 'Bearer <your_token>',
                'Content-Type': 'application/json'
              }
            })
            .then(response => response.json())
            .then(data => console.log(data))
            .catch(error => console.error('Error:', error));

  components:
    securitySchemes:
      bearerAuth:
        type: http
        scheme: bearer
        bearerFormat: JWT

  /api/statistics/products-expiringsoon:
    get:
      summary: Get products expiring soon between now and the next month
      description: |
        Retrieves a paginated list of products with batches expiring within the next month.
        Each entry includes the product ID, product name, expiry date, and the aggregated quantity of items expiring.
      operationId: getProductsExpiringSoon
      tags:
        - Statistics
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          description: Page number for pagination (default is 1)
          required: false
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          description: Number of items per page (default is 10)
          required: false
          schema:
            type: integer
            default: 10
        - name: orderBy
          in: query
          description: Order results by expiry date ("asc" for ascending, "desc" for descending; default is "asc")
          required: false
          schema:
            type: string
            enum: [asc, desc]
            default: asc
      responses:
        "200":
          description: Successful response with a list of products expiring soon.
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        productId:
                          type: integer
                          description: Unique identifier of the product.
                        productName:
                          type: string
                          description: Name of the product.
                        expiryDate:
                          type: string
                          format: date-time
                          description: Expiry date of the product batch.
                        quantity:
                          type: number
                          description: Aggregated quantity of products expiring.
        "401":
          description: Unauthorized - Authentication token is missing or invalid.
        "500":
          description: Internal Server Error.
      x-codeSamples:
        - lang: JavaScript
          source: |
            fetch('/api/products/expiring-soon?page=1&limit=10&orderBy=asc', {
              method: 'GET',
              headers: {
                'Authorization': 'Bearer <your_token>',
                'Content-Type': 'application/json'
              }
            })
            .then(response => response.json())
            .then(data => console.log(data))
            .catch(error => console.error('Error:', error));

  /api/statistics/products-revenues:
    get:
      summary: Get revenue of all products for a specific business
      description: Returns a paginated list of product revenues for the authenticated business.
      operationId: getProductsRevenues
      tags:
        - Statistics
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          description: Page number for pagination (default is 1)
          required: false
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          description: Number of items per page (default is 10)
          required: false
          schema:
            type: integer
            default: 10
        - name: orderBy
          in: query
          description: Order results by revenue ("asc" for ascending, "desc" for descending, default is "desc")
          required: false
          schema:
            type: string
            enum: [asc, desc]
            default: desc
      responses:
        "200":
          description: Successful response with a list of product revenues
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                          description: Name of the product
                        totalRevenue:
                          type: number
                          format: double
                          description: Total revenue generated by the product
        "401":
          description: Unauthorized - Authentication token is missing or invalid
        "500":
          description: Internal Server Error

  /api/statistics/products-stock:
    get:
      summary: Get products with low current stock levels
      description: Returns a paginated list of products that have stock levels less than or equal to 20 for the authenticated business.
      operationId: getProductsStock
      tags:
        - Statistics
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          description: Page number for pagination (default is 1)
          required: false
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          description: Number of items per page (default is 10)
          required: false
          schema:
            type: integer
            default: 10
        - name: orderBy
          in: query
          description: Order results by stock level ("asc" for ascending, "desc" for descending, default is "asc")
          required: false
          schema:
            type: string
            enum: [asc, desc]
            default: asc
      responses:
        "200":
          description: Successful response with a list of products with low stock levels
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                          description: Name of the product
                        currentStock:
                          type: integer
                          description: Current stock level of the product
        "401":
          description: Unauthorized - Authentication token is missing or invalid
        "500":
          description: Internal Server Error
  /api/statistics/products-sales:
    get:
      summary: Get Top Sales Products
      description: >
        Retrieves top sales products for the authenticated business.
        Supports optional filters:
          - Filter by product category (by category name)
          - Filter by specific month and/or year
        Returns a paginated list of products with their total units sold.
      operationId: getProductSales
      tags:
        - Statistics
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          description: Page number for pagination (default is 1)
          required: false
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          description: Number of items per page (default is 10)
          required: false
          schema:
            type: integer
            default: 10
        - name: orderBy
          in: query
          description: Order results by totalUnitsSold ("asc" for ascending, "desc" for descending, default is "desc")
          required: false
          schema:
            type: string
            enum: [asc, desc]
            default: desc
        - name: category
          in: query
          description: Filter by product category id
          required: false
          schema:
            type: integer
        - name: month
          in: query
          description: Filter by month (numeric)
          required: false
          schema:
            type: integer
        - name: year
          in: query
          description: Filter by year (numeric)
          required: false
          schema:
            type: integer
      responses:
        "200":
          description: Successful response with a list of product sales
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        totalUnitsSold:
                          type: integer
                          description: Total number of units sold for the product
                        product:
                          type: object
                          properties:
                            name:
                              type: string
                              description: Name of the product
        "404":
          description: Not Found - Category not found (if filtering by category)
        "401":
          description: Unauthorized - Authentication token is missing or invalid
        "500":
          description: Internal Server Error

  /api/statistics/category-sales:
    get:
      summary: Get Top Sales Categories
      description: >
        Retrieves top sales categories for the authenticated business.
        Returns a paginated list of categories with their total units sold.
      operationId: getCategorySales
      tags:
        - Statistics
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          description: Page number for pagination (default is 1)
          required: false
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          description: Number of items per page (default is 10)
          required: false
          schema:
            type: integer
            default: 10
        - name: orderBy
          in: query
          description: Order results by totalUnitsSold ("asc" for ascending, "desc" for descending, default is "desc")
          required: false
          schema:
            type: string
            enum: [asc, desc]
            default: desc
      responses:
        "200":
          description: Successful response with a list of category sales
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        totalUnitsSold:
                          type: integer
                          description: Total number of units sold for the category
                        category:
                          type: object
                          properties:
                            categoryName:
                              type: string
                              description: Name of the category
        "401":
          description: Unauthorized - Authentication token is missing or invalid
        "500":
          description: Internal Server Error

  /api/statistics/category-revenue:
    get:
      summary: Get category revenue statistics
      description: Retrieves revenue statistics grouped by categoryId for the authenticated business.
      tags:
        - Statistics
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Successful response with category revenue data.
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    name:
                      type: integer
                      description: The ID of the category.
                    revenueAmount:
                      type: number
                      description: Total revenue amount for the category.
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: Error message indicating an internal server error.
      x-codeSamples:
        - lang: JavaScript
          source: |
            fetch('/api/statistics/category-revenue', {
              method: 'GET',
              headers: {
                'Authorization': 'Bearer <your_token>',
                'Content-Type': 'application/json'
              }
            })
            .then(response => response.json())
            .then(data => console.log(data))
            .catch(error => console.error('Error:', error));

  /api/auth/login:
    post:
      summary: Authenticate user and return JWT token
      description: Authenticates user credentials and returns a JWT token in the Authorization header
      operationId: login
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - password
              properties:
                username:
                  type: string
                  example: "admin"
                password:
                  type: string
                  example: "12345678"
      responses:
        "200":
          description: Successfully authenticated
          headers:
            Authorization:
              schema:
                type: string
              description: JWT token for authenticated requests
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Login successfully"
                  token:
                    type: string
                    example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        "400":
          description: Bad Request - Invalid input or incorrect credentials
        "500":
          description: Internal Server Error

  /api/auth/forget-password:
    post:
      summary: Initiate password reset process
      description: Sends password reset instructions to the user's email (test implementation returns token)
      operationId: forgetPassword
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  example: "user@example.com"
      responses:
        "201":
          description: Reset instructions sent (test implementation returns token)
          headers:
            Authorization:
              schema:
                type: string
              description: JWT token (test implementation only)
        "404":
          description: Not Found - Email not registered
        "500":
          description: Internal Server Error

  /api/auth/reset-password:
    post:
      summary: Reset user password
      description: Reset user password using a valid JWT token
      operationId: resetPassword
      tags:
        - Authentication
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - password
              properties:
                password:
                  type: string
                  example: "newSecurePassword123"
      responses:
        "200":
          description: Password reset successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Password updated successfully"
        "400":
          description: Bad Request - Invalid input
        "401":
          description: Unauthorized - Invalid or missing token
        "500":
          description: Internal Server Error

  /api/auth/register:
    post:
      summary: Register new admin and business
      description: Creates a new business entity and its admin user
      operationId: createAdmin
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - admin
                - business
              properties:
                admin:
                  type: object
                  required:
                    - email
                    - username
                    - password
                  properties:
                    name:
                      type: string
                      example: "John Doe"
                    email:
                      type: string
                      format: email
                      example: "admin@business.com"
                    username:
                      type: string
                      example: "admin_user"
                    password:
                      type: string
                      example: "securePassword123"
                    phoneNumber:
                      type: string
                      example: "+1234567890"
                business:
                  type: object
                  required:
                    - name
                    - establishmentDate
                  properties:
                    name:
                      type: string
                      example: "Awesome Business LLC"
                    establishmentDate:
                      type: string
                      format: date-time
                      example: "2023-01-01T00:00:00Z"
                    description:
                      type: string
                      example: "A sample business description"
      responses:
        "201":
          description: Admin and business created successfully
          headers:
            Authorization:
              schema:
                type: string
              description: JWT token for the created admin
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Admin and Business created successfully"
                  admin:
                    type: object
                    properties:
                      id:
                        type: string
                      email:
                        type: string
                  business:
                    type: object
                    properties:
                      id:
                        type: string
                      name:
                        type: string
                  token:
                    type: string
                    example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        "400":
          description: Bad Request - Missing data or validation error
        "500":
          description: Internal Server Error

  /api/staff:
    post:
      summary: Create a new staff member
      description: Creates a new staff member under the authenticated admin's business.
      operationId: createStaff
      tags:
        - Staff
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                staff:
                  type: object
                  required:
                    - email
                    - username
                    - password
                  properties:
                    name:
                      type: string
                      maxLength: 30
                      example: "John Doe"
                    email:
                      type: string
                      format: email
                      example: "john.doe@example.com"
                    username:
                      type: string
                      example: "johndoe"
                    password:
                      type: string
                      minLength: 8
                      example: "secretPassword123"
                    phoneNumber:
                      type: string
                      example: "+1234567890"
              required:
                - staff
      responses:
        "201":
          description: Staff created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Staff created successfully"
                  Staff:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 1
                      email:
                        type: string
                        format: email
                        example: "john.doe@example.com"
                  business:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 10
        "400":
          description: Bad Request - Missing or invalid data
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "User with this email already exists"
        "401":
          description: Unauthorized - Authentication token is missing or invalid
        "403":
          description: Forbidden - Access denied
        "500":
          description: Internal Server Error

    get:
      summary: List staff members
      description: Returns a paginated list of staff members for the authenticated business.
      operationId: listStaff
      tags:
        - Staff
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          description: Page number for pagination (default is 1)
          required: false
          schema:
            type: integer
            default: 1
        - name: orderBy
          in: query
          description: Field to sort results by (default is name)
          required: false
          schema:
            type: string
            default: name
        - name: sortOrder
          in: query
          description: Sort order ("asc" for ascending, "desc" for descending; default is asc)
          required: false
          schema:
            type: string
            enum: [asc, desc]
            default: asc
      responses:
        "200":
          description: Successful response with a list of staff members
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Success"
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                          example: 1
                        name:
                          type: string
                          example: "John Doe"
                        email:
                          type: string
                          format: email
                          example: "john.doe@example.com"
                        username:
                          type: string
                          example: "johndoe"
                        phoneNumber:
                          type: string
                          example: "+1234567890"
                        createdAt:
                          type: string
                          format: date-time
                          example: "2023-01-01T00:00:00Z"
        "400":
          description: Bad Request - Invalid query parameters
        "401":
          description: Unauthorized - Authentication token is missing or invalid
        "403":
          description: Forbidden - Access denied
        "500":
          description: Internal Server Error

  /api/staff/{userId}:
    delete:
      summary: Delete a staff member
      description: Deletes the specified staff member from the authenticated business.
      operationId: deleteStaff
      tags:
        - Staff
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          description: The ID of the staff member to delete
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Staff member deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "successfully deleted staff with id: 1"
        "400":
          description: Bad Request - Invalid user ID or missing data
        "401":
          description: Unauthorized - Authentication token is missing or invalid
        "403":
          description: Forbidden - Access denied
        "404":
          description: Not Found - Staff member not found
        "500":
          description: Internal Server Error

  /api/storage/upload/{type}:
    get:
      summary: Generate a signed upload URL
      description: >
        Generates a signed URL for uploading an image or CSV file for the authenticated business.
        The file type is specified as a path parameter.
      operationId: getSignedUploadURL
      tags:
        - Storage
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: type
          required: true
          schema:
            type: string
            enum:
              - image
              - csv
          description: Type of file to be uploaded. Allowed values are "image" and "csv".
      responses:
        "200":
          description: Signed upload URL generated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  URL:
                    type: string
                    description: Signed URL for uploading the file
                    example: "https://example.com/upload/signedUrl"
                  token:
                    type: string
                    description: Token associated with the signed URL
                    example: "abc123token"
        "400":
          description: Bad Request - Invalid file type provided
        "401":
          description: Unauthorized - Authentication token is missing or invalid
        "403":
          description: Forbidden - Access denied
        "500":
          description: Internal Server Error - Could not generate signed upload URL

  /api/storage/access:
    get:
      summary: Generate a signed access URL
      description: Generates a signed URL for accessing the business profile image.
      operationId: getSignedAccessURL
      tags:
        - Storage
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Signed access URL generated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  URL:
                    type: string
                    description: Signed URL for accessing the image
                    example: "https://example.com/access/signedUrl"
        "401":
          description: Unauthorized - Authentication token is missing or invalid
        "403":
          description: Forbidden - Access denied
        "500":
          description: Internal Server Error - Could not generate signed URL
  /api/storage/delete:
    delete:
      summary: Delete profile image
      description: Deletes the profile image for the authenticated business.
      operationId: deleteURL
      tags:
        - Storage
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Object deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "object deleted successfully"
        "401":
          description: Unauthorized - Authentication token is missing or invalid
        "403":
          description: Forbidden - Access denied
        "500":
          description: Internal Server Error - Could not delete object
  /api/submission/csv:
    get:
      summary: Get CSV submission statuses
      description: >
        Retrieves CSV submission statuses for the authenticated business.
        Returns a list of CSV submissions including their unique ID, current status,
        uploaded date, and any errors encountered during processing.
      operationId: listSubmissions
      tags:
        - Submission
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Successful response with a list of CSV submission statuses.
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                          description: Unique identifier of the CSV submission.
                        status:
                          type: string
                          description: Current status of the CSV submission.
                        uploadedDate:
                          type: string
                          format: date-time
                          description: Date and time when the CSV was uploaded.
                        errors:
                          type: string
                          description: Error details if any issues were encountered.
        "401":
          description: Unauthorized - Authentication token is missing or invalid.
        "500":
          description: Internal Server Error.

  /api/products:
    post:
      summary: Create a new product
      description: Creates a new product for the authenticated business user.
      tags:
        - Products
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  description: The name of the product.
                categoryId:
                  type: integer
                  description: The ID of the category to which the product belongs (optional).
              required:
                - name
      responses:
        "201":
          description: Product created successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Success message.
                  data:
                    type: object
                    properties:
                      id:
                        type: integer
                        description: The unique identifier of the created product.
                      name:
                        type: string
                        description: The name of the product.
                      categoryId:
                        type: integer
                        description: The ID of the category to which the product belongs.
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: Error message indicating the reason for failure.
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: Error message indicating an internal server error.
      x-codeSamples:
        - lang: JavaScript
          source: |
            fetch('/products', {
              method: 'POST',
              headers: {
                'Authorization': 'Bearer <your_token>',
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({
                name: 'Sample Product',
                categoryId: 1
              })
            })
            .then(response => response.json())
            .then(data => console.log(data))
            .catch(error => console.error('Error:', error));

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
